<link href="../blog.css" rel="stylesheet">
<div class="main_container mobile_padding">
    <h5 class="main-subheader"></h5>
    <div class="details_row">
        <div class="details_col_3 hidden_phone">
            <ul class="side-blog-nav">
                <li>BEAUTY</li>
                <li>ENTERTAINMENT</li>
                <li>FAMILY</li>
                <li>FOOD</li>
                <li>LIFESTYLE</li>
                <li>TRAVEL</li>
            </ul>
        </div>
        <div class="details_col_9 blog-right">
            <div class="blog-wrapper-main">
                <div class="post-list post-list-landing" id="post_container">
                    <script id="post_template" type="x-tmpl-mustache/text">
                        <div class="post-item">
                            <h3 class="feature_text text-center"><a href="/posts/{{slug}}">{{title}}</a></h3>
                            <a href="/posts/{{slug}}"><img alt="blog" class="width_100" src="{{post_image}}" /></a>
                            <p class="publish-date">{{published_on}}</p>
                            <div class="post_body">{{{html_body}}}</div>
                        </div>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
    })
    
    function renderPage(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        var post = getPublishedPostDetailsBySlug(slug);
        renderPostDetails("#post_container", "#post_template", post);
        show_content();
    }
    
    function renderPostDetails(container, template, collection){
        var item_list = [];
        var item_rendered = [];
        var template_html = $(template).html();
        $.each( collection , function( key, val ) {
            if (val.image_url.indexOf('missing.png') > -1) {
                val.post_image = site_json.default_image;
            } else {
                val.post_image = val.image_url;
            }
            
            if(val.body.length > 100){
                val.description_short = val.body.substring(0,100) + "...";
            } else {
                val.description_short = val.body;
            }
            
            var date_blog = moment(val.publish_date).tz(getPropertyTimeZone());
            val.published_on = date_blog.format('MMM DD, YYYY');
            var next_p = getNextPublishedPostBySlug(val.slug);
            var prev_p = getPrevPublishedPostBySlug(val.slug);
            if (next_p == undefined){
                val.next_post_show = "display:none";
            } else {
                val.next_post = next_p.title;
                val.next_slug = next_p.slug;
                val.next_post_show = "display:inline-block";
            }
            
            if (prev_p == undefined){
                val.prev_post_show = "display:none";
            } else {
                val.prev_post = prev_p.title;
                val.prev_slug = prev_p.slug;
                val.prev_post_show = "display:inline-block";
            }
            
            if (val.tag != undefined){
                val.tag_list = val.tag.join(', ');
            }
            val.twitter_title= val.title + " via @shopSTC";
            var rendered = Mustache.render(template_html,val);
            item_rendered.push(rendered);
        });
        
        $(container).html(item_rendered.join(''));
    }
</script>