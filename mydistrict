<link href="../blog.css" rel="stylesheet">
<div class="main_container mobile_padding">
    <h4 class="main-header">DISCOVER</h4>
    <h5 class="main-subheader">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam
    </h5>
    <div class="details_row">
        <div class="details_col_3 hidden_phone">
            <ul class="side-blog-nav">
                <li>BEAUTY</li>
                <li>ENTERTAINMENT</li>
                <li>FAMILY</li>
                <li>FOOD</li>
                <li>LIFESTYLE</li>
                <li>TRAVEL</li>
            </ul>
        </div>
        <div class="details_col_9 blog-right">
            <div class="blog-wrapper-main">
                <div class="post-list post-list--landing" id="blog_container">
                    <script id="blog_template" type="x-tmpl-mustache/text">
                        <div class="post-item">
                            <a href="/{{slug}}"><img alt="blog" class="width_100" src="{{post_image}}" /></a>
                            <h3 class="feature_text"><a href="/{{slug}}">{{title}}</a></h3>
                            <p class="blog_description description">{{description_short}}</p>
                            <p class="publish-date">{{published_on}}</p>
                        </div>
                    </script>
            </div>
        </div>
    </div>
</div>



<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
    })
    
    function renderPage(){
        var posts = getAllPublishedPosts();
        var published_posts = posts.sortBy(function(o){ return moment(o.publish_date) }).reverse();
        renderPosts("#blog_container", "#blog_template", published_posts);
        show_content();
    }
    
    function renderPosts(container, template, collection){
        var item_list = [];
        var item_rendered = [];
        var template_html = $(template).html();
        var counter = 1;
        Mustache.parse(template_html);   // optional, speeds up future uses
        $.each( collection , function( key, val ) {
            if (val.image_url.indexOf('missing.png') > -1) {
                val.post_image = "//codecloud.cdn.speedyrails.net/sites/56056be06e6f641a1d020000/image/png/1446826281000/stc-logo-holiday-360 copy.png";
            } else {
                val.post_image = val.image_url;
            }
            
            if(val.body.length > 100){
                val.description_short = val.body.substring(0,100) + "...";
            } else {
                val.description_short = val.body;
            }
            
            val.counter = counter;
            var date_blog = moment(val.publish_date).tz(getPropertyTimeZone());
            val.published_on = date_blog.format('MMM DD, YYYY');
            
            var rendered = Mustache.render(template_html,val);
            item_rendered.push(rendered);
            counter = counter+1;
        });
        
        $(container).show();
        $(container).html(item_rendered.join(''));
    }
</script>